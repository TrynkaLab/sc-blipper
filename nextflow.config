// ---------------------------------------------------------------------------------- //
//                             Nextflow / executor settings
// ---------------------------------------------------------------------------------- //
conda.enabled = true
singularity.enabled = false

manifest.mainScript = "main.nf"

profiles {
    local { includeConfig 'conf/local.config'}
    lsf { includeConfig 'conf/lsf.config'}
    lsf_ignore_errors { includeConfig 'conf/lsf_ignore_errors.config'}
}

report.overwrite=true
trace.overwrite=true

// ---------------------------------------------------------------------------------- //
//                                    Process labels
// ---------------------------------------------------------------------------------- //
includeConfig 'conf/processes.config'

// ---------------------------------------------------------------------------------- //
//                                  Plugins & Schema
// ---------------------------------------------------------------------------------- //
plugins {
  id 'nf-schema@2.4.1'
}

validation {
  help {
    enabled = true
  }
  
  failUnrecognisedParams=true
}


// ---------------------------------------------------------------------------------- //
//                                      Parameters
// ---------------------------------------------------------------------------------- //
params {
    
  // -------------------------------------------------------------------------
  // Global run options
  
  // Path to the manifest
  rn_manifest=null
  
  // The publish folder for the results
  rn_publish_dir=null
  
  // Use node scratch storage instead of workdir
  rn_scratch=true
  
  // Run name, defaults to publishdir
  rn_runname = { ->
    def wdPath = java.nio.file.Paths.get(params.rn_publish_dir).getFileName().toString()
    return wdPath
  }
  
  // If the input objects contain CITEseq, this should be set to the column in var that identifies them
  rn_feature_type_col=null
  
  // -------------------------------------------------------------------------
  // Parameters for the conversion procceses
  convert {
    label="himem"
    container = ""
    conda = "/software/conda/users/ob7/sc-blipper-convert"
    
    // Convert gene names to ensembl ids
    convert_gene_names=true
    
    // TSV file for gene ID conversion, if null this is downloaded from ensembl
    ensembl_id_linker=null
    
    // Used to fetch ensembl ids to gene names
    ensembl_version="114"
  }
  
  // -------------------------------------------------------------------------
  // Options for cNMF
  cnmf {
    label="himem"
    container = ""
    conda = "/software/conda/users/ob7/sc-blipper-convert"
    
    harmony_vars=null
    n_variable=2000
    seed=42
  }

}